!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,n,r){return e=h()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&d(a,n.prototype),a},e.apply(null,arguments)}function n(){return n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?t:n):a.value}},n.apply(this,arguments)}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e,n){return(e=c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function u(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!==t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===t(n)?n:String(n)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function f(e){var n=h();return function(){var r,a=v(e);if(n){var o=v(this).constructor;r=Reflect.construct(a,arguments,o)}else r=a.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}(this,r)}}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function m(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */m=function(){return n};var e,n={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(e){s=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),l=new L(r||[]);return o(i,"_invoke",{value:O(t,n,l)}),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=d;var p="suspendedStart",h="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function x(){}var C={};s(C,l,(function(){return this}));var D=Object.getPrototypeOf,k=D&&D(D(R([])));k&&k!==r&&a.call(k,l)&&(C=k);var _=x.prototype=b.prototype=Object.create(C);function I(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(e,n){function r(o,i,l,u){var c=f(e[o],e,i);if("throw"!==c.type){var s=c.arg,d=s.value;return d&&"object"==t(d)&&a.call(d,"__await")?n.resolve(d.__await).then((function(t){r("next",t,l,u)}),(function(t){r("throw",t,l,u)})):n.resolve(d).then((function(t){s.value=t,l(s)}),(function(t){return r("throw",t,l,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,e){function a(){return new n((function(n,a){r(t,e,n,a)}))}return i=i?i.then(a,a):a()}})}function O(t,n,r){var a=p;return function(o,i){if(a===v)throw new Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var l=r.delegate;if(l){var u=E(l,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===p)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=v;var c=f(t,n,r);if("normal"===c.type){if(a=r.done?y:h,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=y,r.method="throw",r.arg=c.arg)}}}function E(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=f(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function R(n){if(n||""===n){var r=n[l];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,i=function t(){for(;++o<n.length;)if(a.call(n,o))return t.value=n[o],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw new TypeError(t(n)+" is not iterable")}return w.prototype=x,o(_,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=s(x,c,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,s(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},n.awrap=function(t){return{__await:t}},I(S.prototype),s(S.prototype,u,(function(){return this})),n.AsyncIterator=S,n.async=function(t,e,r,a,o){void 0===o&&(o=Promise);var i=new S(d(t,e,r,a),o);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(_),s(_,c,"Generator"),s(_,l,(function(){return this})),s(_,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=R,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,a){return l.type="throw",l.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],l=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},n}function y(t,e,n,r,a,o,i){try{var l=t[o](i),u=l.value}catch(c){return void n(c)}l.done?e(u):Promise.resolve(u).then(r,a)}function g(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){y(o,r,a,i,l,"next",t)}function l(t){y(o,r,a,i,l,"throw",t)}i(void 0)}))}}function b(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||x(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,l=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(l.push(r.value),l.length!==e);u=!0);}catch(t){c=!0,a=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw a}}return l}}(t,e)||x(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){if(t){if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}System.register(["@ibiz-template/runtime","@ibiz-template/vue3-util","vue","qx-util","dayjs","lodash-es","ramda","@ibiz-template/core"],(function(t,r){"use strict";var l,c,d,h,y,x,C,D,k,_,I,S,O,E,N,T,L,R,j,P,A,M,V,z,B,G,F,q,Y,U,Q,$,H,W,K,J,X,Z,tt;return{setters:[function(t){l=t.TreeGridExRowState,c=t.TreeGridExFieldColumnController,d=t.GanttService,h=t.getChildNodeRSs,y=t.getRootNode,x=t.handleAllSettled,C=t.getTreeNode,D=t.GanttDataSetNodeData,k=t.GanttController,_=t.calcDeCodeNameById,I=t.Srfuf,S=t.TreeGridExNotifyState,O=t.isValueChange,E=t.registerPanelItemProvider,N=t.registerControlProvider},function(t){T=t.useNamespace,L=t.PanelRawItemController,R=t.withInstall,j=t.useControlController},function(t){P=t.defineComponent,A=t.createVNode,M=t.ref,V=t.computed,z=t.watch,B=t.createTextVNode,G=t.resolveComponent,F=t.isVNode,q=t.getCurrentInstance,Y=t.onMounted,U=t.withDirectives,Q=t.resolveDirective,$=t.h},function(t){H=t.createUUID},function(t){W=t.default},function(t){K=t.isObject},function(t){J=t.isNotNil},function(t){X=t.ModelError,Z=t.RuntimeError,tt=t.awaitTimeout}],execute:function(){var et=function(t){var e=new Date(t),n=W(e),r=W();return n.isSame(r,"day")},nt=function(t,e){return t.replace(/\${(.*?)}/g,(function(t,n){var r=w(n.split("."),2),a=r[0],o=r[1],i=e[a]||"";return K(i)?i[o]?i[o]:"":i}))},rt=function(t,e){var n=W(t).day();return e.includes(n)},at=function(t,e){var n,r=[],a=0,o=nt(e,t.data&&t.data._deData?t.data._deData:{});try{n=JSON.parse(o)}catch(i){n={}}return n.weekdays&&(r=n.weekdays.split("").map((function(t){return Number(t)}))),n.dayCapacityVal&&(a=Number(n.dayCapacityVal)),Object.assign(n,{weekdays:r,dayCapacity:a}),n},ot=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=W(t).startOf("day");return e.filter((function(t){var e=t._beginDataItemValue?W(t._beginDataItemValue).startOf("day"):null,r=t._endDataItemValue?W(t._endDataItemValue).startOf("day"):null;return!(e&&r&&e.isAfter(r))&&(!e&&r&&n.isSame(r,"day")||e&&!r&&n.isSame(e,"day")||e&&r&&function(t,e,n){var r=W(t),a=W(e),o=W(n);if(!(r instanceof W&&a instanceof W&&o instanceof W))throw new Error("All arguments must be dayjs objects");return r.isAfter(a)&&r.isBefore(o)||r.isSame(a)||r.isSame(o)}(n,e,r))})).length},it=P({name:"TopLevelCell",props:{cellData:{type:Object,required:!0,default:function(){}},showText:{type:Boolean,required:!0,default:!0},capacityConfig:{type:Object,default:function(){}}},emits:["cellClick"],setup:function(t,e){var n=e.emit,r=T("top-level-cell"),a=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=n-t/e*n;return"polygon(0px ".concat(r,"%, 100% ").concat(r,"%, 100% ").concat(n,"%, 0px ").concat(n,"%)")};return{ns:r,renderContent:function(){if(!t.cellData.column)return"";var e=function(){var e=t.cellData,n=e.column,r=e.row;if("WORKITEMCOUNT"===t.capacityConfig.calcType)return ot(n.date,r.data._children)}()||0,o=function(t,e){var n={};return t<e&&Object.assign(n,{"clip-path":a(t,e)}),n}(e,t.capacityConfig.dayCapacity),i=function(t,e){var n=[];return 0===t?[]:(t>e&&(n=[r.em("caption","exceed")]),t===e&&(n=[r.em("caption","saturation")]),t<e&&(n=[r.em("caption","standard")]),n)}(e,t.capacityConfig.dayCapacity);return A("div",{class:[r.e("caption")].concat(b(i)),onClick:function(e){return function(e){e.stopPropagation(),n("cellClick",t.cellData)}(e)}},[t.showText?A("span",{class:[r.em("caption","text")]},[String(e)]):"",A("div",{class:[r.em("caption","bkg")],style:o},null)])}}},render:function(){return A("div",{class:this.ns.b()},[this.renderContent()])}}),lt=P({name:"TotalProgress",props:{row:{type:l,required:!0},capacityConfig:{type:Object,required:!0,default:function(){}},dateRange:{type:Object,required:!0,default:function(){}}},setup:function(t){var e=T("total-progress"),n=M(0),r=M(0),a=V((function(){return n.value/r.value*100})),o=function(){return"WORKITEMCOUNT"===t.capacityConfig.calcType?function(e,n){var r=t.dateRange,a=r.start,o=r.end,i=0,l=0,u=0;if(n.length>0){for(var c=new Date(a);c<=new Date(o);)rt(c,t.capacityConfig.weekdays)&&(i+=1,l+=ot(c,n)),c.setDate(c.getDate()+1);u=i*e}return{numerator:l,denominator:u}}(t.capacityConfig.dayCapacity,t.row.data._children):{numerator:0,denominator:0}};return z((function(){return t.row}),(function(){var t=o();n.value=t.numerator,r.value=t.denominator}),{immediate:!0,deep:!0}),{ns:e,numerator:n,denominator:r,percentage:a}},render:function(){return A("div",{class:this.ns.b()},[A("span",{class:this.ns.e("caption")},[this.numerator,B(" / "),this.denominator]),A(G("el-progress"),{percentage:this.percentage},null)])}}),ut=P({name:"IBizResourceGanttExFieldColumn",props:{controller:{type:c,required:!0},row:{type:l,required:!0},parentRow:{type:Object},column:{type:Object},capacityConfig:{type:Object,required:!0,default:function(){}},groupConfig:{type:Object,required:!0,default:function(){}},dateRange:{type:Object,required:!0,default:function(){}},level:{type:Number,default:0},isTopFirstIndex:{type:Boolean,default:!1}},setup:function(t){var e=T("tree-grid-ex-field-column"),n=T("resource-gantt-ex-field-column"),r=V((function(){return t.controller.nodeColumnControllerMap.get(t.row.data._nodeId)})),a=V((function(){return"DE"!==t.row.data._nodeType&&t.controller.isFirstShowColumn?t.row.data._text:t.row.data[t.controller.name]})),o=M(""),i=V((function(){var t=r.value;if(t){if(t.nodeEditItem)return;return t.codeList?o.value:t.formatValue(a.value)+(t.unitName||"")}return a.value})),l=V((function(){if("ellipsis"===t.controller.treeGrid.overflowMode&&J(a.value)&&""!==a.value)return i.value})),u=V((function(){return a.value&&r.value&&(r.value.isLinkColumn||r.value.hasClickAction)})),c=function(){var e=g(m().mark((function e(n,a){var o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(o=r.value)||void 0===o?void 0:o.onActionClick(n,t.row,a);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s=function(t,e,n){var r=t.data;return r&&r._children&&r._children.length>1?r._children.reduce((function(t,r){return e.data&&r._deData&&e.data._deData&&r._deData[n.groupField]===e.data._deData[n.groupField]?t+1:t}),0):0},d=V((function(){var e="",n=t.parentRow,r=t.row;return t.level>1&&n&&s(n,r,t.groupConfig)>1&&(e=function(t,e,n){var r=t.data;if(r&&r._children&&r._children.length>1){var a=r._children.find((function(t){return e.data&&t._deData&&e.data._deData&&t._deData[n.groupField]===e.data._deData[n.groupField]}));return a&&e.data._id===a._id}return!1}(n,r,t.groupConfig)?"first-index":"no-first-index"),e})),f=V((function(){var e={},n=t.level,r=t.parentRow,a=t.row;if(n&&n>1&&r){var o=s(r,a,t.groupConfig);if(o>1){var i=46*o-5;Object.assign(e,{height:"".concat(i,"px")})}}return e}));return{ns:e,ns2:n,nodeColumn:r,fieldValue:a,showText:i,clickable:u,tooltip:l,calcMergeClass:d,calcMergeStyle:f,onInfoTextChange:function(t){o.value=t},onTextClick:function(e){var n;null===(n=r.value)||void 0===n||n.onTextClick(t.row,e)},onActionClick:c}},render:function(){var t,e,n,r,a,o,i=null;if(i=null!==(t=this.nodeColumn)&&void 0!==t&&t.nodeEditItem?A(G("iBizTreeGridExEditColumn"),{controller:this.nodeColumn,row:this.row},null):null!==(e=this.nodeColumn)&&void 0!==e&&e.codeList?A(G("iBizCodeList"),{class:this.ns.e("text"),codeListItems:this.nodeColumn.codeListItems,codeList:this.nodeColumn.codeList,value:this.fieldValue,onClick:this.onTextClick,onInfoTextChange:this.onInfoTextChange,title:this.tooltip},null):A("span",{class:this.ns.e("text"),title:this.tooltip,onClick:this.onTextClick},[this.showText]),this.$slots.actions)o=this.$slots.actions();else if(this.row.columnActionsStates[this.controller.name]){var l;o=A(mt,{class:this.ns.e("toolbar"),actionDetails:null===(l=this.nodeColumn)||void 0===l?void 0:l.nodeColumn.deuiactionGroup.uiactionGroupDetails,actionsState:this.row.columnActionsStates[this.controller.name],mode:"dropdown",popperClass:this.ns2.b("popper"),groupLevelKeys:[],onActionClick:this.onActionClick},null)}var u=null;return 1===this.level&&(u=A(lt,{row:this.row,capacityConfig:this.capacityConfig,dateRange:this.dateRange},null)),A("div",{class:[this.ns.b(),this.ns2.b(),this.clickable&&this.ns.m("clickable"),this.ns.m(this.controller.treeGrid.overflowMode),null===(n=this.controller.model.cellSysCss)||void 0===n?void 0:n.cssName,this.ns.is("has-action",!!o),null!==(r=this.row)&&void 0!==r&&r.data._children&&0===(null===(a=this.row)||void 0===a||null===(a=a.data._children)||void 0===a?void 0:a.length)?"no-children":"",this.isTopFirstIndex?"top-first-index":"",this.calcMergeClass],style:this.calcMergeStyle},[A("div",{class:[this.ns.b("text-container"),this.ns2.b("text-container")]},[i]),o,u])}}),ct=function(){return A("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[A("g",{"stroke-width":"1","fill-rule":"evenodd"},[A("path",{d:"M6.751 12.303A5.557 5.557 0 0 1 1.2 6.751C1.2 3.691 3.69 1.2 6.751 1.2a5.558 5.558 0 0 1 5.551 5.551 5.557 5.557 0 0 1-5.551 5.552M6.751 0a6.751 6.751 0 1 0 4.309 11.949l3.855 3.855a.6.6 0 1 0 .849-.849l-3.854-3.853A6.751 6.751 0 0 0 6.751 0"},null)])])},st=function(){return A("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[A("g",{"stroke-width":"1","fill-rule":"evenodd"},[A("g",{transform:"translate(3.347 1.67)"},[A("path",{d:"M8.31 4.544l-3.858-3.01L.757 4.537 0 3.606 4.435 0l4.613 3.598-.738.946zM.778 7.934l3.805 3.077L8.33 8.074l.74.944-4.497 3.528-4.55-3.679.755-.933z"},null)])])])},dt=function(){return A("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[A("g",{"stroke-width":"1","fill-rule":"evenodd"},[A("g",{transform:"translate(3.347 1.67)"},[A("path",{d:"M.738 0l3.858 3.01L8.291.008l.757.93-4.435 3.606L0 .946.738 0zM8.31 12.544l-3.858-3.01-3.695 3.003L0 11.606 4.435 8l4.613 3.598-.738.946z"},null)])])])},ft=function(){return A("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",height:"1em",width:"1em","data-v-6fbb019e":""},[A("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null)])},pt=function(t){s(d,t);var e,n,r,l,c=f(d);function d(){return i(this,d),c.apply(this,arguments)}return u(d,[{key:"fetchNodeDatasByType",value:(l=g(m().mark((function t(e,n,r,o){var i,l,u,c,s,d,f,p,v,y,b,w=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=0===h(this.model,{parentId:e.id,hasQuery:o.hasQuery}).length,u=a(a({},o),{},{leaf:l}),c=[],r||this.model.rootVisible){t.next=10;break}return t.next=6,this.getStaticGanttNodeData(e,n,r,u);case 6:s=t.sent,c=[s],t.next=27;break;case 10:t.t0=e.treeNodeType,t.next="STATIC"===t.t0?13:"DE"===t.t0?18:"CODELIST"===t.t0?22:26;break;case 13:return t.next=15,this.getStaticGanttNodeData(e,n,r,u);case 15:return d=t.sent,c=[d],t.abrupt("break",27);case 18:return t.next=20,this.getDEGanttNodeDatas(e,n,r,u);case 20:case 24:return c=t.sent,t.abrupt("break",27);case 22:return t.next=24,this.getCodeListGanttNodeDatas(e,n,r,u);case 26:throw new X(e,ibiz.i18n.t("runtime.controller.control.gantt.noSupport",{treeNodeType:e.treeNodeType}));case 27:if(f=e.expandFirstOnly,p=e.expanded,v=e.rootNode,y=v&&!this.model.rootVisible,l){t.next=42;break}if(!r||r._parent){t.next=40;break}return t.next=33,Promise.all(c);case 33:return c=t.sent,t.next=36,this.fetchAllChildNodes(c,o);case 36:b=t.sent,c.forEach(function(){var t=g(m().mark((function t(e){var n;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.fetchCustomChildNodes(e,o,b||[]);case 2:n=t.sent,e._children=n;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=42;break;case 40:return t.next=42,Promise.all(c.map(function(){var t=g(m().mark((function t(e,n){var r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(p&&(!f||f&&0===n)||y)){t.next=5;break}return t.next=3,w.fetchChildNodes(e,o);case 3:r=t.sent,e._children=r;case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 42:return null===(i=c)||void 0===i||i.forEach((function(t){t._beginDataItemValue||(t._beginDataItemValue=t._endDataItemValue),t._endDataItemValue||(t._endDataItemValue=t._beginDataItemValue)})),c=this.groupSort(c||[],o.groupField),t.abrupt("return",c);case 45:case"end":return t.stop()}}),t,this)}))),function(t,e,n,r){return l.apply(this,arguments)})},{key:"fetchCustomChildNodes",value:function(t,e,n){var r,a=[];if(t&&n.length>0){var o=e.hasQuery,i=(h(this.model,{parentId:t._nodeId,hasQuery:o})[0]||{}).parentFilter;n.forEach((function(e){i&&e._deData&&t._value===e._deData[i]&&(e._parent=t,a.push(e))}))}return null===(r=a)||void 0===r||r.forEach((function(t){t._beginDataItemValue||(t._beginDataItemValue=t._endDataItemValue),t._endDataItemValue||(t._endDataItemValue=t._beginDataItemValue)})),a=this.groupSort(a||[],e.groupField)}},{key:"fetchChildNodes",value:(r=g(m().mark((function t(e,n){var r,a,o,i,l=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.hasQuery,a=[],e){t.next=9;break}return o=y(this.model),t.next=6,this.fetchNodeDatasByType(o,void 0,void 0,n);case 6:a=t.sent,t.next=16;break;case 9:if(0!==(i=h(this.model,{parentId:e._nodeId,hasQuery:r})).length){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,x(i.map(function(){var t=g(m().mark((function t(r){var a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=C(l.model,r.childDETreeNodeId),t.abrupt("return",l.fetchNodeDatasByType(a,r,e,n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!1);case 14:t.sent.forEach((function(t){var e;(e=a).push.apply(e,b(t))}));case 16:return t.abrupt("return",a);case 17:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"groupSort",value:function(t,e){var n={},r=0;return t.forEach((function(t){var a=t._deData&&t._deData[e]?t._deData[e]:"";a in n||(n[a]=r,r+=1)})),t.sort((function(t,r){return(t._deData&&t._deData[e]?n[t._deData[e]]:-1)-(r._deData&&r._deData[e]?n[r._deData[e]]:-1)})),t}},{key:"getFilterNodes",value:function(t){var e=[];return t.forEach((function(t){t._value&&e.push(t._value)})),e.join(",")}},{key:"fetchAllChildNodes",value:(n=g(m().mark((function t(e,n){var r,o,i,l,u=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.hasQuery,o=[],i=a({},e[0]),0!==(l=h(this.model,{parentId:i._nodeId,hasQuery:r})).length){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,x(l.map(function(){var t=g(m().mark((function t(r){var o,l,c;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=C(u.model,r.childDETreeNodeId),r.parentFilter&&Object.assign(i,{_value:u.getFilterNodes(e)}),l=0===h(u.model,{parentId:o.id,hasQuery:n.hasQuery}).length,c=a(a({},n),{},{leaf:l}),t.abrupt("return",u.getCustomDEGanttNodeDatas(o,r,i,c));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!1);case 8:return t.sent.forEach((function(t){o.push.apply(o,b(t))})),t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"getCustomDEGanttNodeDatas",value:(e=g(m().mark((function t(e,n,r,a){var i,l,u,c,s,d,f,p,h,v,y=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.appDEDataSetId,l=e.appDataEntityId,u=n?this.getNodeRSFilterParams(n,r,a):{context:a.context,params:a.params,navContext:{},navParams:{}},c=u.context,s=u.params,d=u.navContext,f=u.navParams,s.size=e.maxSize||1e3,e.sortAppDEFieldId&&Object.assign(s,{sort:"".concat(e.sortAppDEFieldId.toLowerCase(),",").concat(e.sortDir?e.sortDir.toLowerCase():"asc")}),(p=n?n.parentFilter:"")&&s["n_".concat(p.toLowerCase(),"_eq")]&&(Object.assign(s,o({},"n_".concat(p.toLowerCase(),"_in"),s["n_".concat(p.toLowerCase(),"_eq")])),delete s["n_".concat(p.toLowerCase(),"_eq")]),t.next=8,this.app.deService.exec(l,i,c,s);case 8:if(!(h=t.sent).data.length){t.next=12;break}return v=h.data.map((function(t,n){var o=y.calcExpand(e,n);return new D(y.model,e,r,{data:t,leaf:!!a.leaf,navContext:d,navParams:f,defaultExpand:o})})),t.abrupt("return",v);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),t,this)}))),function(t,n,r,a){return e.apply(this,arguments)})}]),d}(d),ht=function(t){s(w,t);var e,r,l,c,d,h,y,b=f(w);function w(){var t;i(this,w);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return o(p(t=b.call.apply(b,[this].concat(n))),"isInitialLoad",!0),t}return u(w,[{key:"_evt",get:function(){return this.evt}},{key:"initService",value:(y=g(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.service=new pt(this.model),t.next=3,this.service.init(this.context);case 3:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"initState",value:function(){n(v(w.prototype),"initState",this).call(this),this.state.showCapacity=!0,this.state.onlyTopNodes=!1,this.state.showWeekdays=[],this.state.capacityConfig=JSON.stringify({calcType:"WORKITEMCOUNT",fieldName:"",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.work_item_count}"}),this.state.sliderDraggable=!0,this.state.sliderShowContent='"${show_identifier}  ${title}"',this.state.groupConfig={groupField:"project_id"},this.state.contextMap=JSON.stringify({project:"${project_id}"}),this.state.sliderLimit=!0,this.state.expandAll=!1,this.calcDataRange()}},{key:"handleControlParams",value:function(){if(n(v(w.prototype),"handleControlParams",this).call(this),this.controlParams.sliderdraggable&&(this.state.sliderDraggable="true"===this.controlParams.sliderdraggable),this.controlParams.slidershowcontent&&(this.state.sliderShowContent=this.controlParams.slidershowcontent),this.controlParams.groupconfig)try{this.state.groupConfig=JSON.parse(this.controlParams.groupconfig)}catch(t){this.state.groupConfig={}}this.controlParams.sliderlimit&&(this.state.sliderLimit="true"===this.controlParams.sliderlimit),this.controlParams.expandall&&(this.state.expandAll="true"===this.controlParams.expandall),this.controlParams.contextmap&&(this.state.contextMap=this.controlParams.contextmap)}},{key:"setDateRange",value:function(t){this.state.dateRange=t}},{key:"showCapacityChange",value:function(t){this.state.showCapacity=t}},{key:"fullscreenChange",value:function(){this._evt.emit("onFullscreenChange",{})}},{key:"noWeekendDays",value:function(t){this.state.showWeekdays=t?[1,2,3,4,5]:[0,1,2,3,4,5,6]}},{key:"capacityCalcChange",value:function(t){this.state.capacityConfig=JSON.stringify(t)}},{key:"onlyTopNodesChange",value:function(t){this.state.onlyTopNodes=t}},{key:"calcDataRange",value:function(){var t=this.view.getController("searchform");if(t){var e=t.state.data;this.state.dateRange={start:e.n_date_scope_gtandeq,end:e.n_date_scope_ltandeq}}else{var n=new Date;this.state.dateRange={start:W(n.getTime()-6048e5).format("YYYY-MM-DD"),end:W(n).format("YYYY-MM-DD")}}}},{key:"getNodeDataByNodeId",value:function(t){return this.state.items.filter((function(e){return e._nodeId===t})).map((function(t){var e={};return t._deData&&(e=a(a({},t._deData),{},{srfkey:t._deData.srfkey})),e}))}},{key:"load",value:(h=g(m().mark((function t(){var e,r=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},this.calcDataRange(),this.isInitialLoad=!0===e.isInitialLoad,t.abrupt("return",n(v(w.prototype),"load",this).call(this,e));case 4:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"loadNodes",value:(d=g(m().mark((function t(e){var n,r,a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFetchParams();case 2:return n=t.sent,r=!!n.query,this.state.isLoading=!this.isInitialLoad,t.prev=5,t.next=8,this.service.fetchChildNodes(e,{context:this.context.clone(),params:n,hasQuery:r,groupField:this.state.groupConfig.groupField,defaultExpandedKeys:this.state.expandedKeys});case 8:if(t.t0=t.sent,t.t0){t.next=11;break}t.t0=[];case 11:a=t.t0;case 12:return t.prev=12,this.state.isLoading=!1,t.finish(12);case 15:return e?e._children=a:this.state.rootNodes=a,t.next=18,this.afterLoadNodes(a);case 18:return t.abrupt("return",a);case 19:case"end":return t.stop()}}),t,this,[[5,,12,15]])}))),function(t){return d.apply(this,arguments)})},{key:"startLoading",value:(c=g(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.ctx.startLoading();case 1:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"openData",value:(l=g(m().mark((function t(e){var n,r,a,o,i,l,u,c,s,d;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.data,o=e.context,i=e.params,l=a[0],u=this.getNodeModel(l._nodeId),c=u.appDataEntityId,s=_(c),o[s.toLowerCase()]=null===(n=l._deData)||void 0===n?void 0:n.srfkey,t.next=8,null===(r=this.viewScheduler)||void 0===r?void 0:r.triggerCustom("".concat(u.id.toLowerCase(),"_opendata"),{context:o,params:i,data:a,event:void 0,view:this.view,ctrl:this});case 8:if(-1!==(d=t.sent)){t.next=13;break}throw new Error(ibiz.i18n.t("runtime.controller.control.calendar.missingViewLogic",{itemType:u.id.toLowerCase()}));case 13:return t.abrupt("return",{cancel:!d.ok});case 14:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"save",value:(r=g(m().mark((function t(e){var n,r,a,o,i,l,u,c,s;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.isSimple){t.next=3;break}return ibiz.log.debug(ibiz.i18n.t("runtime.controller.common.md.simpleMode")),t.abrupt("return");case 3:if("DE"===e._nodeType){t.next=5;break}throw new Z(ibiz.i18n.t("runtime.controller.control.gantt.nonentity"));case 5:if(n=this.state.rows[e._uuid]){t.next=8;break}throw new Z(ibiz.i18n.t("runtime.controller.common.md.rowData"));case 8:if(n.modified){t.next=11;break}return ibiz.log.debug(ibiz.i18n.t("runtime.controller.common.md.noChange")),t.abrupt("return");case 11:if(!n.processing){t.next=15;break}return t.next=14,tt(500,this.save.bind(this),[e]);case 14:return t.abrupt("return");case 15:return r=this.getNodeModel(e._nodeId),a=r.appDataEntityId,o=e._deData.srfuf===I.CREATE,i=_(a),(l=this.context.clone())[i]=e._deData.srfkey,u=nt(this.state.contextMap,e._deData||{})||"{}",Object.assign(l,JSON.parse(u)),c=ibiz.hub.getApp(this.context.srfappid),t.prev=24,t.next=27,c.deService.exec(a,o?"create":"update",l,e._deData);case 27:s=t.sent,t.next=36;break;case 30:return t.prev=30,t.t0=t.catch(24),t.next=34,this.evt.emit("onSaveError",void 0);case 34:throw this.actionNotification("".concat(o?"CREATE":"UPDATE","ERROR"),{error:t.t0,data:n.data}),t.t0;case 36:return n.data._deData=s.data,n.modified=!1,this.gridStateNotify(n,S.SAVE),t.next=41,this.evt.emit("onSaveSuccess",void 0);case 41:case"end":return t.stop()}}),t,this,[[24,30]])}))),function(t){return r.apply(this,arguments)})},{key:"setRowValue",value:(e=g(m().mark((function t(e,n,r){var a,o,i;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.model,o=a.beginDataItemName,i=a.endDataItemName,!Object.prototype.hasOwnProperty.call(e.data,n)||O(e.data[n],r)){t.next=3;break}return t.abrupt("return");case 3:if(n!==o&&n!==i||(l=e.data[n],u=r,c="day",!W(l).isSame(W(u),c))){t.next=5;break}return t.abrupt("return");case 5:return e.data[n]=r,n===o?e.data._beginDataItemValue=r:n===i&&(e.data._endDataItemValue=r),e.modified=!0,e.processing=!0,t.prev=9,t.next=12,this.dataChangeNotify(e,[n]);case 12:return t.prev=12,e.processing=!1,t.finish(12);case 15:case"end":return t.stop()}var l,u,c}),t,this,[[9,,12,15]])}))),function(t,n,r){return e.apply(this,arguments)})}]),w}(k),vt=P({name:"ResourceGanttColumnHead",props:{controller:{type:ht,required:!0,default:function(){}},model:{type:Object,required:!0,default:function(){}},expandAll:{type:Boolean,required:!0,default:!1},titleData:{type:Object,required:!0,default:function(){}}},emits:["expandAllChange","headSearch"],setup:function(t,e){var n=e.emit,r=t.controller,a=T("resource-gantt-column-head"),o=M(!1),i=M(!1),l=M(""),u=V((function(){return t.titleData.label}));z((function(){return t.expandAll}),(function(t){o.value=t}),{immediate:!0});var c=function(){o.value=!o.value,n("expandAllChange",o.value)},s=function(){n("headSearch",l.value)},d=function(t){t.preventDefault(),t.stopPropagation(),i.value=!1,n("headSearch","")},f=function(){var e=g(m().mark((function e(n,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.controller.doUIAction(n.uiactionId,{},r,n.appId);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),p=function(){return A(G("el-input"),{modelValue:l.value,"onUpdate:modelValue":function(t){return l.value=t},class:a.b("search"),onInput:s,placeholder:"搜索成员"},{prefix:function(){return A(ct,null,null)},suffix:function(){return A(G("el-button"),{class:a.be("search","suffix"),onClick:d},{default:function(){return[A(ft,null,null)]}})}})},h=function(){var t,e=r.getNodeModel("root"),n=r.state.selectedData;if(null!=e&&null!==(t=e.decontextMenu)&&void 0!==t&&null!==(t=t.detoolbarItems)&&void 0!==t&&t.length){var a=r.contextMenuInfos[e.id];return a.clickTBUIActionItem&&a.onlyOneActionItem?null:A(G("iBizContextMenuControl"),{modelData:e.decontextMenu,groupLevelKeys:[50],nodeModel:e,nodeData:n,context:r.context,onActionClick:function(t,e){return f(t,e)}},null)}};return{c:r,ns:a,label:u,isHeadSearch:i,expand:o,renderHeadSearch:p,onColumnHeadClick:function(t){t.preventDefault(),t.stopPropagation()},onExpandAllChange:c,renderContent:function(){return i.value?p():A("div",{class:a.b("box")},[A("div",{class:a.be("box","left")},[A(G("el-button"),{class:a.bem("box","left","icon"),title:o.value?"全部收起":"全部展开",onClick:c},{default:function(){return[o.value?A(dt,null,null):A(st,null,null)]}}),A("div",{class:a.bem("box","left","caption")},[u.value])]),A("div",{class:a.be("box","right")},[A(G("el-button"),{size:"small",title:"搜索成员",class:[a.e("item")],onClick:function(t){return function(t,e){e.stopPropagation(),i.value=!0}(0,t)}},{icon:function(){return A("div",{class:a.e("icon")},[A(ct,null,null)])}}),h()])])}}},render:function(){return A("div",{class:this.ns.b()},[this.renderContent()])}});var mt=P({name:"IBizResourceActionToolbar",props:{actionDetails:{type:Array,required:!0},actionsState:{type:Object,required:!0},caption:String,mode:{type:String,default:"buttons"},groupLevelKeys:{type:Object,default:[50]},zIndex:{type:Number},popperClass:String},emits:["actionClick"],setup:function(t,e){var n,r=e.emit,a=T("action-toolbar"),o=T("resource-action-toolbar"),i=M(),l=M(!1),u=M(!1);null===(n=t.actionDetails)||void 0===n||n.forEach((function(t){t.capLanguageRes&&t.capLanguageRes.lanResTag&&(t.caption=ibiz.i18n.t(t.capLanguageRes.lanResTag,t.caption)),t.tooltipLanguageRes&&t.tooltipLanguageRes.lanResTag&&(t.tooltip=ibiz.i18n.t(t.tooltipLanguageRes.lanResTag,t.tooltip))}));var c=function(){var e=g(m().mark((function e(n,a){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.stopPropagation(),"buttons"===t.mode?l.value=!1:i.value&&i.value.handleClose(),r("actionClick",n,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s=M([]),d=M([]);t.actionDetails&&t.actionDetails.forEach((function(e){-1!==t.groupLevelKeys.findIndex((function(t){return t===e.actionLevel}))?d.value.push(e):s.value.push(e)}));var f=M(),p=t.zIndex;return{ns:a,ns2:o,dropdownRef:i,popoverIndex:p,expandDetails:s,groupDetails:d,groupButtonRef:f,popoverVisible:l,dropdownVisible:u,handleClick:c,calcActionItemClass:function(t){var e=t.actionLevel;return[a.e("item"),a.is("disabled",!1),a.em("item","level-".concat(e))]},onVisibleChange:function(t){u.value=t}}},render:function(){var t,e=this,n=this.actionDetails||[],r=function(t){return A(G("el-divider"),{class:e.ns.e("separator"),"border-style":"double",direction:t?"vertical":"horizontal"},null)},a=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.map((function(t){return e.actionsState[t.id].visible?[t.addSeparator&&r(n),A(G("el-button"),{text:!0,size:"small",onClick:function(n){return e.handleClick(t,n)},title:t.tooltip,disabled:e.actionsState[t.id].disabled,class:e.calcActionItemClass(t)},{default:function(){return[A("div",{class:e.ns.em("item","icon")},[t.showIcon&&t.sysImage&&A(G("iBizIcon"),{icon:t.sysImage},null)]),A("div",{class:e.ns.em("item","label")},[t.showCaption?t.caption:""])]}})]:null}))};if(null!==(t=this.actionsState)&&void 0!==t&&t.visible)return"buttons"===this.mode?A("div",{class:[this.ns.b(),this.ns.m("buttons")],onClick:function(t){return t.stopPropagation()}},[a(this.expandDetails),function(){var t;if(0===e.groupDetails.length)return null;if(-1===e.groupDetails.findIndex((function(t){return!0===e.actionsState[t.id].visible})))return null;var n,r=-1===e.groupDetails.findIndex((function(t){return!1===e.actionsState[t.id].disabled}));return[A(G("el-button"),{size:"small",text:!0,disabled:r,ref:"groupButtonRef",class:[e.ns.e("item"),e.ns.is("expand",e.popoverVisible)]},{icon:function(){return A(G("ion-icon"),{class:e.ns.e("icon"),name:"ellipsis-vertical-outline",title:ibiz.i18n.t("component.actionToolbar.more")},null)}}),A(G("el-popover"),{placement:"bottom-start","virtual-ref":e.groupButtonRef,trigger:"click",visible:e.popoverVisible,"onUpdate:visible":function(t){return e.popoverVisible=t},"popper-class":e.ns.e("popover"),"virtual-triggering":!0,"popper-style":"z-index:".concat(e.popoverIndex)},(n=t=a(e.groupDetails,!1),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!F(n)?t:{default:function(){return[t]}}))]}()]):A(G("el-dropdown"),{ref:"dropdownRef",onCommand:function(t){return e.handleClick(t,new MouseEvent("click"))},trigger:"click",class:[this.ns.b(),this.ns.m("dropdown"),this.dropdownVisible?this.ns2.e("open"):""],placement:"bottom-start","popper-class":this.popperClass,onVisibleChange:this.onVisibleChange},{default:function(){return A("span",{class:e.ns.e("caption")},[e.caption,A(G("ion-icon"),{class:e.ns.e("caption-icon"),name:"ellipsis-vertical-outline"},null)])},dropdown:function(){return A(G("el-dropdown-menu"),null,{default:function(){return[n.length>0&&n.map((function(t){return e.actionsState[t.id].visible?A(G("el-dropdown-item"),{class:[e.ns.e("item"),e.ns.is("disabled",!1)],title:t.tooltip,disabled:e.actionsState[t.id].disabled,command:t},{default:function(){return[t.showIcon&&t.sysImage&&A(G("iBizIcon"),{icon:t.sysImage},null),t.showCaption?t.caption:""]}}):null}))]}})}})}}),yt=function(t){s(n,t);var e=f(n);function n(){return i(this,n),e.apply(this,arguments)}return u(n)}(L),gt=P({name:"IBizPanelResourceState",props:{modelData:{type:Object,required:!0},controller:{type:yt,required:!0}},setup:function(t){var e=T("panel-rawitem"),n=T("panel-resource-state"),r=M(""),a=[{tag:"standard",name:"标准"},{tag:"saturation",name:"饱和"},{tag:"exceed",name:"超出"}],o=t.modelData.rawItem;o&&o.cssStyle&&(r.value=o.cssStyle);var i=V((function(){var r=t.modelData.id,a=[e.b(),n.b(),e.m(r)];return a.push.apply(a,b(t.controller.containerClass)),a}));return{ns:e,classArr:i,tempStyle:r,renderContent:function(){return a.map((function(t){return A("div",{class:[n.e("content"),n.e(t.tag)]},[A("div",{class:[n.em("content","star")]},null),A("div",{class:n.em("content","caption")},[t.name])])}))}}},render:function(){var t=this;if(this.controller.state.visible)return A("div",{class:this.classArr,style:this.tempStyle,onClick:function(){t.controller.onClick()}},[this.renderContent()])}}),bt=function(){function t(){i(this,t),o(this,"component","IBizPanelResourceState")}var e;return u(t,[{key:"createController",value:(e=g(m().mark((function t(e,n,r){var a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new yt(e,n,r),t.next=3,a.init();case 3:return t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}(),wt=R(gt,(function(t){t.component(gt.name,gt),E("CUSTOM_RESOURCE_STATE",(function(){return new bt}))})),xt=P({name:"IBizResourceGanttControl",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object},loadDefault:{type:Boolean,default:!0},mdctrlActiveMode:{type:Number,default:void 0},singleSelect:{type:Boolean,default:void 0}},setup:function(t){var n,o=j((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e(ht,n)})),i=M(),l=M(),u=M(!1),c=T("control-".concat(o.model.controlType.toLowerCase())),s=T("control-resource-gantt"),d=M(),f=M(!1),p=M();p.value=H();var h=G("IBizRawItem"),v=G("IBizIcon"),y=!1,w=[],x=["blue","light-blue","blue-cyan","pink","purple","violet","indigo","cyan","teal","green","light-green","lime","yellow","amber","orange","grey","sky-blue"],C=null===(n=q())||void 0===n?void 0:n.appContext.app;Y((function(){r.import("@ibiz-template-plugin/gantt").then((function(t){var e=t.default;null==C||C.use(e),u.value=!0}))}));var D=function(t){var e=document.documentElement;return getComputedStyle(e).getPropertyValue(t)},k=V((function(){var t,e;return{primaryColor:(null===(t=o.state.ganttStyle)||void 0===t?void 0:t.primaryColor)||D("--ibiz-color-bg-0"),textColor:(null===(e=o.state.ganttStyle)||void 0===e?void 0:e.textColor)||D("--ibiz-color-text-2")}})),_=V((function(){var t,e={};return null===(t=o.model.detreeNodes)||void 0===t||t.forEach((function(t,n){var r=n%x.length;e[t.id]="rgba(".concat(D("--ibiz-".concat(x[r],"-0")),", 1)")})),e})),I=V((function(){return!!o.state.isLoaded&&o.state.isLoading})),S=V((function(){var t,e,n;return o.state.onlyTopNodes?(n=o.state.rootNodes,o.model.rootVisible||(n=(null===(e=o.state.rootNodes[0])||void 0===e?void 0:e._children)||[]),n.map((function(t){var e={};return Object.assign(e,t),e._children&&(e._children=null),e}))):o.model.rootVisible?o.state.rootNodes:null===(t=o.state.rootNodes[0])||void 0===t||null===(t=t._children)||void 0===t?void 0:t.filter((function(t){return!d.value||t.name.includes(d.value)}))})),O=V((function(){var t=[];return o.state.columnStates.forEach((function(e){var n,r=null===(n=o.columns[e.key])||void 0===n?void 0:n.model;!e.hidden&&r&&t.push(r)})),t})),E=V((function(){return ibiz.i18n.getLang().toLowerCase()})),N=function(t,e){y||f.value?f.value=!1:(o.onTreeNodeClick(t,e),y=!0,setTimeout((function(){y=!1}),200))},L=function(t){o.onDbTreeNodeClick(t)};o.evt.on("onNewRow",(function(t){if(i.value){var e=t.row.data;i.value.setExpand(e)}}));var R=function(){var t;null===(t=i.value)||void 0===t||t.fullscreenChange()};o._evt.on("onFullscreenChange",(function(t){R()}));var P,z=function(t){d.value=t},B=function(t){o.state.expandAll=t},F=function(t){console.log("抛值内容",t)},U=function t(e,n,r,a){var i=[];return e.forEach((function(e){if("SEPERATOR"!==e.itemType){var l=a[e.id];if(!l||l.visible){var u={};if(e.showCaption&&e.caption&&(u.label=e.caption),e.sysImage&&e.showIcon&&(u.icon=A(v,{icon:e.sysImage},null)),"DEUIACTION"===e.itemType){u.disabled=l.disabled,u.clickClose=!0;var c=e.uiactionId;c&&(u.onClick=function(){o.doUIAction(c,n,r,e.appId)})}else if("RAWITEM"===e.itemType){e.rawItem&&(u.label=A(h,{rawItem:e},null))}else if("ITEMS"===e.itemType){var s;null!==(s=e.detoolbarItems)&&void 0!==s&&s.length&&(u.children=t(e.detoolbarItems,n,r,a))}i.push(u)}}else i.push({divided:"self"})})),i};o.evt.on("onMounted",(function(){if(Object.values(o.contextMenus).length>0){r.import("@imengyu/vue3-context-menu").then((function(t){(P=t.default).default&&!P.showContextMenu&&(P=P.default)}))}}));var Q=function(){var t=g(m().mark((function t(e,n){var r,a,i,l;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.stopPropagation(),n.preventDefault(),null!=(r=o.getNodeModel(e._nodeId))&&r.decontextMenu){t.next=5;break}return t.abrupt("return");case 5:if((a=o.contextMenus[r.decontextMenu.id]).model.detoolbarItems){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,a.calcButtonState(e._deData||(e.srfkey?e:void 0),r.appDataEntityId);case 10:if(i=a.state.buttonsState,(l=U(a.model.detoolbarItems,e,n,i)).length){t.next=14;break}return t.abrupt("return");case 14:P.showContextMenu({x:n.x,y:n.y,customClass:c.b("context-menu"),items:l});case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{c:o,ns:c,ns2:s,fullscreenChange:R,ganttRef:i,ganttBoxRef:l,isInited:u,ganttId:p,data:S,locale:E,columns:O,onCheck:function(t,e){if(t)w.push(e);else{var n=w.findIndex((function(t){return t._id===e._id}));n>-1&&w.splice(n,1)}o.setSelection(w)},loading:I,ganttStyle:k,onNodeClick:N,onNodeDbClick:L,onNodeExpand:function(t){o.onExpandChange(t,!0),t&&!t._children&&o.refreshNodeChildren(t)},onNodeCollapse:function(t){o.onExpandChange(t,!1)},renderContent:function(){var t=O.value.map((function(t,e){return function(t,e){var n=t.caption,r=t.codeName,a=t.width,i=t.headerSysCss,l=t.align,u=o.columns[r];return A(G("x-gantt-column"),{label:n,prop:r,width:a&&a>30?a:30,center:"center"===(null==l?void 0:l.toLowerCase())},{title:function(e){var n=e.label;return"name"===r?A(vt,{key:r,model:t,controller:o,titleData:e,expandAll:o.state.expandAll,class:null==i?void 0:i.cssName,onExpandAllChange:B,onHeadSearch:z},null):A("div",{class:null==i?void 0:i.cssName},[n])},default:function(t){var e=t.row,n=t.column,a=t.level,i=o.getRowState(e._id);if(i){if("name"===r){var l,c=at(i,o.state.capacityConfig);e._parent&&(l=o.getRowState(e._parent._id));var s=!(!S.value||!S.value[0])&&S.value[0]._id===i.data._id;return A(ut,{controller:u,capacityConfig:c,dateRange:o.state.dateRange,groupConfig:o.state.groupConfig,row:i,parentRow:l,column:n,level:a,isTopFirstIndex:s,key:i.data._uuid+r},null)}var d=G(o.providers[r].component);return $(d,{controller:u,row:i,key:i.data._uuid+r})}return null}})}(t)})),e=A(G("x-gantt-slider"),{"allow-link":!1,move:o.state.sliderDraggable,"resize-left":o.state.sliderDraggable,"resize-right":o.state.sliderDraggable,"move-by-unit":!0,"slider-limit":o.state.sliderLimit},{content:function(t){var e=t.row,n=t.level,r=t.left;if(1!==n){var a=nt(o.state.sliderShowContent,e._deData||{}).replace(/^"(.*?)"$/,"$1"),i=r<0?"".concat(-r,"px"):"";return A("div",{class:[c.e("slider"),s.e("slider")],style:{background:_.value[e._nodeId]},onClick:function(t){return N(e,t)},onDblclick:function(){return L(e)},onContextmenu:function(t){return Q(e,t)}},[a&&A("div",{class:s.em("slider","caption"),style:{marginLeft:i},title:a,innerHTML:a},null)])}}});return[].concat(b(t),[e])},renderGanttCell:function(t){if(1===t.level){var e=o.getRowState(t.row._id)||{},n=at(e,o.state.capacityConfig);if(rt(t.column.date,n.weekdays)){var r={};return Object.assign(r,a(a({},t),{},{row:e})),A(it,{cellData:r,showText:o.state.showCapacity,capacityConfig:n,onCellClick:F},null)}}},renderGanttTitle:function(t){var e,n,r=t.column,a=function(t){var e=new Date(t);return["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][W(e).day()]}(r.date),o=(e=r.date,n="MM/DD",W(e).format(n));return A("div",{class:[c.b("column-title"),et(r.date)?c.be("column-title","today"):""]},[A("div",{class:c.be("column-title","top")},[a]),A("div",{class:c.be("column-title","bottom")},[o])])},onSliderMove:function(t){var e,n=null===(e=t[0])||void 0===e?void 0:e.row,r={begin:n._beginDataItemValue?W(n._beginDataItemValue).format("YYYY-MM-DD HH:mm:ss"):void 0,end:n._endDataItemValue?W(n._endDataItemValue).format("YYYY-MM-DD HH:mm:ss"):void 0};f.value=!0,o.modifyNodeTime(n,r)},renderNoData:function(){return o.state.isLoaded&&A(G("iBizNoData"),{text:o.model.emptyText,emptyTextLanguageRes:o.model.emptyTextLanguageRes},null)}}},render:function(){var t,e=this;return this.isInited?U(A(G("iBizControlBase"),{ref:"ganttBoxRef",controller:this.c,class:[this.ns.b(),this.ns2.b(),null!==(t=this.data)&&void 0!==t&&t.length?"":this.ns.m("empty")]},{default:function(){return[A(G("x-gantt"),{ref:"ganttRef",id:e.ganttId,"data-id":"_id",data:e.data,"row-height":46,"show-expand":!0,"expand-all":e.c.state.expandAll,"start-key":"_beginDataItemValue","end-key":"_endDataItemValue",children:"_children",leaf:"_leaf",dateRange:e.c.state.dateRange,showWeekdays:e.c.state.showWeekdays,locale:e.locale,"header-height":46,showCheckbox:!e.c.state.singleSelect,showToday:!1,showWeekend:!1,onNodeExpand:e.onNodeExpand,onNodeCollapse:e.onNodeCollapse,onRowClick:e.onNodeClick,onRowDblClick:e.onNodeDbClick,onRowChecked:e.onCheck,onMoveSlider:e.onSliderMove,primaryColor:e.ganttStyle.primaryColor,headerStyle:{textColor:e.ganttStyle.textColor}},{default:function(){return e.renderContent()},ganttCell:function(t){return e.renderGanttCell(t)},ganttTitle:function(t){return e.renderGanttTitle(t)},empty:function(){return e.renderNoData()}})]}}),[[Q("loading"),this.loading]]):null}}),Ct=u((function t(){i(this,t),o(this,"component","IBizResourceGanttControl")})),Dt=t("IBizResourceGanttControl",R(xt,(function(t){t.component(xt.name,xt),N("TREE_RENDER_RESOURCE_GANTT",(function(){return new Ct}))})));t("default",{install:function(t){t.use(Dt),t.use(wt)}})}}}))}();
